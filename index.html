<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Weather Briefer</title>

<style>
body {
  background:#0b1c2d;
  color:#e6eef6;
  font-family: system-ui, -apple-system, sans-serif;
  padding:20px;
}
h2 { margin-bottom: 10px; }
input {
  width:100%;
  font-size:18px;
  padding:14px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}
.grid {
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:10px;
  margin-top:12px;
}
button {
  padding:12px;
  font-size:16px;
  background:#1e88e5;
  color:white;
  border:none;
  border-radius:8px;
}
button.secondary {
  background:#3b4d63;
}
pre {
  background:#102a43;
  padding:15px;
  margin-top:15px;
  border-radius:8px;
  white-space:pre-wrap;
  font-size:15px;
}
</style>
</head>

<body>

<h2>AI Weather Briefer</h2>

<input id="icao" placeholder="ICAO (KCLT, EGLL, RJTT)" />

<div class="grid">
  <button onclick="run('metar')">METAR</button>
  <button onclick="run('taf')">TAF</button>
  <button onclick="run('both')">BOTH</button>
  <button class="secondary" onclick="run('pirep')">PIREPs</button>
  <button class="secondary" onclick="run('airsigmet')">SIGMET</button>
  <button class="secondary" onclick="aiBrief()">AI BRIEF</button>
</div>

<pre id="out"></pre>

<script>
const BASE = "https://metar-proxy.leopassley-00.workers.dev";

function clean(text, icao) {
  return text
    .replace(/^METAR\s+/gm,"")
    .replace(/^TAF\s+/gm,"")
    .replace(new RegExp(`^${icao}\\s+\\d{6}Z\\s+`,"gm"),"")
    .trim();
}

async function run(type) {
  const icao = document.getElementById("icao").value.toUpperCase().trim();
  const out = document.getElementById("out");

  if (!icao && ["metar","taf","both","pirep"].includes(type)) {
    out.textContent = "ENTER ICAO";
    return;
  }

  try {
    if (type === "both") {
      const m = await fetch(`${BASE}/metar?ids=${icao}`).then(r=>r.text());
      const t = await fetch(`${BASE}/taf?ids=${icao}`).then(r=>r.text());
      out.textContent =
`METAR ${icao}
----------------
${clean(m,icao)}

TAF ${icao}
----------------
${clean(t,icao)}`;
      return;
    }

    const endpoint =
      type === "metar" ? `/metar?ids=${icao}` :
      type === "taf" ? `/taf?ids=${icao}` :
      type === "pirep" ? `/pirep?ids=${icao}` :
      `/airsigmet`;

    const data = await fetch(BASE + endpoint).then(r=>r.text());
    out.textContent = clean(data, icao) || "NO DATA";
  } catch {
    out.textContent = "ERROR FETCHING DATA";
  }
}

async function aiBrief() {
  const icao = document.getElementById("icao").value.toUpperCase().trim();
  const out = document.getElementById("out");

  if (!icao) {
    out.textContent = "ENTER ICAO";
    return;
  }

  out.textContent = "GENERATING AI BRIEFâ€¦";

  try {
    const data = await fetch(`${BASE}/aibrief?ids=${icao}`).then(r => r.text());
    out.textContent = data;
  } catch {
    out.textContent = "AI BRIEF FAILED";
  }
}
</script>

</body>
</html>
