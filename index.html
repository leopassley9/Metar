<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Weather Briefer</title>
<style>
body { background:#0b1c2d; color:#e6eef6; font-family:system-ui; padding:20px }
input,button { width:100%; font-size:18px; padding:12px; margin-top:10px }
button { background:#1e88e5; color:white; border:none; border-radius:6px }
pre { background:#102a43; padding:15px; margin-top:15px; border-radius:6px; white-space:pre-wrap }
</style>
</head>
<body>

<h2>AI Weather Briefer</h2>

<input id="cmd" placeholder="KCLT | MET KCLT | TAF KCLT | BOTH KCLT | PIREP KCLT">

<button onclick="run()">Run</button>

<pre id="out"></pre>

<script>
const BASE = "https://metar-proxy.leopassley-00.workers.dev";

function getICAO(t) {
  const m = t.match(/\b[A-Z]{4}\b/);
  return m ? m[0] : null;
}

function intent(t) {
  t = t.toUpperCase();
  if (t.includes("BOTH")) return "BOTH";
  if (t.includes("TAF")) return "TAF";
  if (t.includes("PIRE")) return "PIRE";
  if (t.includes("SIG")) return "SIG";
  if (t.includes("TCF")) return "TCF";
  return "METAR";
}

async function run() {
  const raw = document.getElementById("cmd").value.toUpperCase();
  const icao = getICAO(raw);
  const out = document.getElementById("out");

  if (!icao) {
    out.textContent = "NO ICAO FOUND";
    return;
  }

  try {
    const mode = intent(raw);

    if (mode === "METAR") {
      const r = await fetch(`${BASE}/metar?ids=${icao}`);
      out.textContent = format("METAR", icao, await r.text());
    }

    if (mode === "TAF") {
      const r = await fetch(`${BASE}/taf?ids=${icao}`);
      out.textContent = format("TAF", icao, await r.text());
    }

    if (mode === "BOTH") {
      const m = await (await fetch(`${BASE}/metar?ids=${icao}`)).text();
      const t = await (await fetch(`${BASE}/taf?ids=${icao}`)).text();
      out.textContent =
        format("METAR", icao, m) + "\n\n" +
        format("TAF", icao, t);
    }

    if (mode === "PIRE") {
      const r = await fetch(`${BASE}/pirep?ids=${icao}`);
      out.textContent = r.text ? await r.text() : "NO PIREPS";
    }

    if (mode === "SIG") {
      const r = await fetch(`${BASE}/airsigmet`);
      out.textContent = await r.text();
    }

    if (mode === "TCF") {
      const r = await fetch(`${BASE}/tcf`);
      out.textContent = await r.text();
    }

  } catch {
    out.textContent = "ERROR";
  }
}

function format(title, icao, text) {
  const line = text.trim().split("\n")[0]
    .replace(/^METAR\s+/,"")
    .replace(/^TAF\s+/,"")
    .replace(new RegExp(`^${icao}\\s+\\d{6}Z\\s+`),"");

  return `${title} ${icao}\n----------------\n${line}`;
}
</script>

</body>
</html>